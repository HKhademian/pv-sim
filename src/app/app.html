<main class="main">

  <div class="wrap">
    <label>Battery (kWh)</label>
    <input class="range" type="range" min="0" max="20" step="1" [(ngModel)]="scenario.batteryKWh" />
    <div>{{ scenario.batteryKWh() }}</div>
  </div>
  <div class="row">
    <label>Self-consumption (no batt)</label>
    <input class="range" type="range" min="0.20" max="0.45" step="0.01"
      [(ngModel)]="scenario.selfConsumptionNoBattery" />
    <div>{{ scenario.selfConsumptionNoBattery() | number:'1.2-2' }}</div>
  </div>

  <div class="row" style="justify-content:flex-end">
    <button class="btn" (click)="addScenario()">Add scenario</button>
  </div>

  <div class="card" style="margin-top:16px">
    <div class="row" style="margin-bottom:8px">
      <h3 style="margin:0">Your Scenarios</h3>
      <div class="muted small">stored locally • works offline</div>
    </div>
    <table *ngIf="scenarios().length > 0">
      <thead>
        <tr>
          <th>Scenario</th>
          <th>PV (kWp)</th>
          <th>Battery (kWh)</th>
          <th>Production (kWh/yr)</th>
          <th>Self-used (kWh/yr)</th>
          <th>Export (kWh/yr)</th>
          <th>Grid import (kWh/yr)</th>
          <th>Savings Y1</th>
          <th>Capex</th>
          <th>Payback</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let s of scenarios(); let i = index">
          <td style="text-align:left">
            <div>{{ s.name }}</div>
            <div class="small muted">Load: {{ s.annualLoadKWh | number:'1.0-0' }} kWh • Yield: {{ s.yieldKWhPerKwp |
              number:'1.0-0' }}</div>
          </td>
          <td>{{ s.pvSizeKwp }}</td>
          <td>{{ s.batteryKWh }}</td>
          <td>{{ result(s).productionKWh | number:'1.0-0' }}</td>
          <td>{{ result(s).selfUsedEffectiveKWh | number:'1.0-0' }}</td>
          <td>{{ result(s).exportKWh | number:'1.0-0' }}</td>
          <td>{{ result(s).gridImportKWh | number:'1.0-0' }}</td>
          <td>{{ result(s).year1SavingsEur | currency:'EUR' }}</td>
          <td>{{ result(s).capexEur | currency:'EUR' }}</td>
          <td>
            <span class="pill">{{ result(s).simplePaybackYears | number:'1.1-1' }} yrs</span>
          </td>
          <td><button class="btn" (click)="removeAt(i)" style="padding:6px 10px">Delete</button></td>
        </tr>
      </tbody>
    </table>
    <div *ngIf="scenarios().length === 0" class="muted">No scenarios yet. Add one from the form above.</div>
  </div>


  <div class="muted small" style="margin-top:8px">
    Tip: For Munich, start with yield ≈ 1014 kWh/kWp·yr, grid price 0.38 €/kWh, feed-in 0.0786 €/kWh.
  </div>

</main>

<router-outlet />
